<VirtualHost *:80>
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/webmail/

        <Directory /var/www/webmail/>
                Options FollowSymLinks MultiViews
                AllowOverride All
                Order allow,deny
                allow from all
        </Directory>
        LogLevel warn

        SetEnvIf Remote_Addr "::1" loopback
        SetEnvIf Remote_Addr "127\.0\.0\.1" loopback
        CustomLog /var/log/apache2/webmail_access.log combined env=!loopback
        #ServerSignature Off

        RewriteEngine on

        # -- Configuracao para funcionamento correto com o switch de conteudo
        ReWriteCond %{SERVER_PORT} !^443$
        RewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [NC,R,L]

</VirtualHost>

#NameVirtualHost *:443
<VirtualHost *:443>
	ServerAdmin root@bsvconsultoria.com.br
	ServerName webmail.bsvconsultoria.com.br
	DocumentRoot /var/www/webmail

        SSLEngine On
        SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL

	SSLCertificateFile    /etc/certificados/no.pwd.bsvconsultoria.pem
        SSLCertificateKeyFile /etc/certificados/no.pwd.bsvconsultoria.key
        SSLCACertificatePath /etc/certificados
        #SSLCACertificateFile /etc/certificados/AC-Raiz-Dataprev-cacert.pem


        SSLVerifyClient none
        SSLVerifyDepth  10

        SSLOptions +StdEnvVars +ExportCertData


	<Directory /var/www/webmail>
		Options +FollowSymLinks
		# AddDefaultCharset     UTF-8
		AddType text/x-component .htc

		<IfModule mod_php5.c>
			php_flag        display_errors  Off
			php_flag        log_errors      On
			# php_value     error_log       logs/errors
			php_value       upload_max_filesize     10M
			php_value       post_max_size           12M
			php_value       memory_limit            64M
			php_flag        zlib.output_compression         Off
			php_flag        magic_quotes_gpc                Off
			php_flag        magic_quotes_runtime            Off
			php_flag        zend.ze1_compatibility_mode     Off
			php_flag        suhosin.session.encrypt         Off
			#php_value      session.cookie_path             /
			php_flag        session.auto_start      Off
			php_value       session.gc_maxlifetime  21600
			php_value       session.gc_divisor      500
			php_value       session.gc_probability  1
		</IfModule>

		<IfModule mod_rewrite.c>
			RewriteEngine On
			RewriteRule ^favicon\.ico$ skins/larry/images/favicon.ico
			# security rules:
			# - deny access to files not containing a dot or starting with a dot
			#   in all locations except installer directory
			RewriteRule ^(?!installer)(\.?[^\.]+)$ - [F]
			# - deny access to some locations
			RewriteRule ^/?(\.git|\.tx|SQL|bin|config|logs|temp|tests|program\/(include|lib|localization|steps)) - [F]
			# - deny access to some documentation files
			RewriteRule /?(README\.md|composer\.json-dist|composer\.json|package\.xml)$ - [F]
		</IfModule>

		<IfModule mod_deflate.c>
			SetOutputFilter DEFLATE
		</IfModule>

		<IfModule mod_headers.c>
			# replace 'append' with 'merge' for Apache version 2.2.9 and later
			# Header append Cache-Control public env=!NO_CACHE
		</IfModule>

		<IfModule mod_expires.c>
			ExpiresActive On
			ExpiresDefault "access plus 1 month"
		</IfModule>

		FileETag MTime Size

		<IfModule mod_autoindex.c>
			Options -Indexes
		</ifModule>

		AllowOverride None
		Order allow,deny
		Allow from all
	</Directory>
	
	<Directory /var/www/webmail/plugins/enigma/home>
		Options -FollowSymLinks
		AllowOverride None
		Order allow,deny
		Deny from all
	</Directory>

	<Directory /var/www/webmail/config>
		Options -FollowSymLinks
		AllowOverride None
		Order allow,deny
		Deny from all
	</Directory>

	<Directory /var/www/webmail/temp>
		Options -FollowSymLinks
		AllowOverride None
		Order allow,deny
		Deny from all
	</Directory>

	<Directory /var/www/webmail/logs>
		Options -FollowSymLinks
		AllowOverride None
		Order allow,deny
		Deny from all
	</Directory>
	
	ErrorLog /var/log/apache2/error_roundcube.log

	# Possible values include: debug, info, notice, warn, error, crit,
	# alert, emerg.
	LogLevel warn

	CustomLog /var/log/apache2/access_roundcube.log combined
	
</VirtualHost>
